<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AI Gender & Age Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .drop-zone {
            transition: all 0.3s ease;
        }
        .drop-zone:hover {
            border-color: #4f46e5;
            background-color: #f8fafc;
        }
        .drop-zone.dragover {
            border-color: #4f46e5;
            background-color: #f1f5f9;
        }
        .result-card {
            transition: all 0.3s ease;
        }
        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .loading {
            display: none;
        }
        .loading.active {
            display: flex;
        }
        .stats-card {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .confidence-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .confidence-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-2xl font-bold gradient-text">AI Vision</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-gray-600 hover:text-indigo-600">Home</a>
                    <span class="text-gray-600">Dashboard</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Stats Section -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="stats-card rounded-lg p-6 text-white">
                    <h3 class="text-lg font-medium mb-2">Total Detections</h3>
                    <p class="text-3xl font-bold" id="totalDetections">0</p>
                </div>
                <div class="stats-card rounded-lg p-6 text-white">
                    <h3 class="text-lg font-medium mb-2">Average Confidence</h3>
                    <p class="text-3xl font-bold" id="avgConfidence">0%</p>
                </div>
                <div class="stats-card rounded-lg p-6 text-white">
                    <h3 class="text-lg font-medium mb-2">Success Rate</h3>
                    <p class="text-3xl font-bold" id="successRate">0%</p>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-900">Upload Image</h2>
                    <button id="clearHistory" class="text-sm text-gray-600 hover:text-indigo-600">
                        Clear History
                    </button>
                </div>
                <div class="drop-zone border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer"
                     id="dropZone">
                    <div class="space-y-4">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <div class="text-gray-600">
                            <p class="text-lg font-medium">Drag and drop your image here</p>
                            <p class="text-sm">or</p>
                            <button class="mt-2 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Browse Files
                            </button>
                        </div>
                        <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                    </div>
                    <input type="file" id="fileInput" class="hidden" accept="image/*">
                </div>
            </div>

            <!-- Loading Indicator -->
            <div class="loading items-center justify-center space-x-2 mb-8" id="loadingIndicator">
                <div class="w-4 h-4 bg-indigo-600 rounded-full animate-bounce"></div>
                <div class="w-4 h-4 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                <div class="w-4 h-4 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                <span class="text-gray-600">Processing image...</span>
            </div>

            <!-- Results Section -->
            <div class="bg-white rounded-lg shadow-sm p-6" id="resultsSection">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Results</h2>
                <div id="resultsContent" class="text-center text-gray-500">
                    Upload an image to see results
                </div>
            </div>

            <!-- History Section -->
            <div class="bg-white rounded-lg shadow-sm p-6 mt-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-900">Recent Detections</h2>
                    <div class="flex items-center space-x-2">
                        <button id="exportHistory" class="text-sm text-gray-600 hover:text-indigo-600">
                            Export History
                        </button>
                    </div>
                </div>
                <div id="historyContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- History items will be added here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultsContent = document.getElementById('resultsContent');
        const historyContent = document.getElementById('historyContent');
        const totalDetections = document.getElementById('totalDetections');
        const avgConfidence = document.getElementById('avgConfidence');
        const successRate = document.getElementById('successRate');
        const clearHistoryBtn = document.getElementById('clearHistory');
        const exportHistoryBtn = document.getElementById('exportHistory');

        let detectionHistory = [];
        let totalFacesDetected = 0;
        let successfulDetections = 0;

        // Handle file selection
        function handleFileSelect(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                alert('File size must be less than 10MB');
                return;
            }

            uploadFile(file);
        }

        // Upload file to server
        function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);

            loadingIndicator.classList.add('active');
            resultsContent.innerHTML = '';

            fetch('/process', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                loadingIndicator.classList.remove('active');
                if (data.error) {
                    resultsContent.innerHTML = `<div class="text-red-500">${data.error}</div>`;
                } else {
                    displayResults(data);
                    addToHistory(data);
                    updateStats(data);
                }
            })
            .catch(error => {
                loadingIndicator.classList.remove('active');
                resultsContent.innerHTML = `<div class="text-red-500">Error processing image: ${error.message}</div>`;
            });
        }

        // Display results
        function displayResults(data) {
            const results = data.results;
            let html = '<div class="space-y-6">';
            
            results.forEach((result, index) => {
                html += `
                    <div class="result-card bg-white border border-gray-200 rounded-lg p-4">
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                <img src="${data.image_url}" alt="Detected face" class="w-24 h-24 object-cover rounded-lg">
                            </div>
                            <div class="flex-1">
                                <h3 class="text-lg font-medium text-gray-900">Face ${index + 1}</h3>
                                <div class="mt-2 space-y-2">
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-600">Gender:</span>
                                        <span class="font-medium ${result.gender === 'Male' ? 'text-blue-600' : 'text-pink-600'}">${result.gender}</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-600">Age:</span>
                                        <span class="font-medium text-gray-900">${result.age}</span>
                                    </div>
                                    <div class="space-y-1">
                                        <div class="flex items-center justify-between text-sm">
                                            <span class="text-gray-600">Confidence:</span>
                                            <span class="font-medium text-gray-900">${(result.confidence * 100).toFixed(1)}%</span>
                                        </div>
                                        <div class="confidence-bar">
                                            <div class="confidence-bar-fill" style="width: ${result.confidence * 100}%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsContent.innerHTML = html;
        }

        // Add to history
        function addToHistory(data) {
            const historyItem = {
                timestamp: new Date().toISOString(),
                imageUrl: data.image_url,
                results: data.results
            };
            
            detectionHistory.unshift(historyItem);
            if (detectionHistory.length > 10) {
                detectionHistory.pop();
            }
            
            updateHistoryDisplay();
        }

        // Update history display
        function updateHistoryDisplay() {
            historyContent.innerHTML = detectionHistory.map(item => `
                <div class="result-card bg-white border border-gray-200 rounded-lg p-4">
                    <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <img src="${item.imageUrl}" alt="Recent detection" class="w-20 h-20 object-cover rounded-lg">
                        </div>
                        <div class="flex-1">
                            <div class="text-sm text-gray-500">${new Date(item.timestamp).toLocaleString()}</div>
                            <div class="mt-1 text-sm">
                                <span class="font-medium">${item.results.length} face${item.results.length > 1 ? 's' : ''} detected</span>
                            </div>
                            <div class="mt-1 text-xs text-gray-500">
                                ${item.results.map(r => `${r.gender}, ${r.age}`).join(' | ')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update statistics
        function updateStats(data) {
            totalFacesDetected += data.results.length;
            successfulDetections += data.results.filter(r => r.confidence > 0.5).length;
            
            totalDetections.textContent = totalFacesDetected;
            avgConfidence.textContent = `${((successfulDetections / totalFacesDetected) * 100).toFixed(1)}%`;
            successRate.textContent = `${((successfulDetections / totalFacesDetected) * 100).toFixed(1)}%`;
        }

        // Clear history
        clearHistoryBtn.addEventListener('click', () => {
            detectionHistory = [];
            totalFacesDetected = 0;
            successfulDetections = 0;
            updateHistoryDisplay();
            updateStats({ results: [] });
        });

        // Export history
        exportHistoryBtn.addEventListener('click', () => {
            const historyData = JSON.stringify(detectionHistory, null, 2);
            const blob = new Blob([historyData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `detection-history-${new Date().toISOString()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Event Listeners
        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFileSelect(e.target.files[0]));

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            handleFileSelect(file);
        });
    </script>
</body>
</html> 